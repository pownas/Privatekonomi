@using Privatekonomi.Core.Models
@using MudBlazor

<MudDialog>
    <DialogContent>
        <MudTextField @bind-Value="_name" 
                      Label="Namn" 
                      Variant="Variant.Outlined"
                      Required="true"
                      MaxLength="200"
                      HelperText="Ge sparmålet ett tydligt och beskrivande namn"
                      Class="mb-4" />
        
        <MudTextField @bind-Value="_description" 
                      Label="Beskrivning" 
                      Variant="Variant.Outlined"
                      Lines="4"
                      MaxLength="500"
                      HelperText="Beskriv sparmålet mer detaljerat (valfritt)"
                      Class="mb-4" />

        <MudNumericField @bind-Value="_targetAmount" 
                         Label="Målbelopp (kr)" 
                         Variant="Variant.Outlined"
                         Min="0"
                         Format="N2"
                         Culture="@(new System.Globalization.CultureInfo("sv-SE"))"
                         Adornment="Adornment.End"
                         AdornmentText="kr"
                         HelperText="Det totala belopp ni vill spara"
                         Class="mb-4" />

        <MudNumericField @bind-Value="_currentAmount" 
                         Label="Startbelopp (kr)" 
                         Variant="Variant.Outlined"
                         Min="0"
                         Format="N2"
                         Culture="@(new System.Globalization.CultureInfo("sv-SE"))"
                         Adornment="Adornment.End"
                         AdornmentText="kr"
                         HelperText="Det belopp ni redan har sparat (valfritt)"
                         Class="mb-4" />

        <MudDatePicker @bind-Date="_targetDate"
                       Label="Målsättningsdatum"
                       Variant="Variant.Outlined"
                       HelperText="När vill ni ha nått målet? (valfritt)"
                       Class="mb-4" />

        <MudSelect @bind-Value="_priority" Label="Prioritet" Variant="Variant.Outlined" Class="mb-4" HelperText="Hur viktig är detta sparmål?">
            <MudSelectItem Value="1">1 - Högst</MudSelectItem>
            <MudSelectItem Value="2">2 - Hög</MudSelectItem>
            <MudSelectItem Value="3">3 - Normal</MudSelectItem>
            <MudSelectItem Value="4">4 - Låg</MudSelectItem>
            <MudSelectItem Value="5">5 - Lägst</MudSelectItem>
        </MudSelect>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Avbryt</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Submit" Disabled="@(!IsValid())">Skapa</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    public required IMudDialogInstance MudDialog { get; set; }

    private string _name = string.Empty;
    private string? _description;
    private decimal _targetAmount = 0;
    private decimal _currentAmount = 0;
    private DateTime? _targetDate = DateTime.Now.AddMonths(12);
    private int _priority = 3;

    private void Cancel()
    {
        MudDialog.Cancel();
    }

    private void Submit()
    {
        if (!IsValid()) return;

        var sharedGoal = new SharedGoal
        {
            Name = _name,
            Description = _description,
            TargetAmount = _targetAmount,
            CurrentAmount = _currentAmount,
            TargetDate = _targetDate,
            Priority = _priority
        };

        MudDialog.Close(DialogResult.Ok(sharedGoal));
    }

    private bool IsValid()
    {
        return !string.IsNullOrWhiteSpace(_name) && _targetAmount > 0;
    }
}
