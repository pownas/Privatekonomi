@page "/Account/Register"
@attribute [AllowAnonymous]
@using Microsoft.AspNetCore.Authorization

<PageTitle>Registrera</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small" Class="mt-8">
    <MudPaper Elevation="3" Class="pa-6">
        <MudText Typo="Typo.h4" Align="Align.Center" GutterBottom="true">
            Skapa konto
        </MudText>
        
        @if (!string.IsNullOrEmpty(ErrorMessage))
        {
            <MudAlert Severity="Severity.Error" Class="mb-4">@ErrorMessage</MudAlert>
        }
        
        <form method="post" action="/Account/PerformRegister">
            <MudTextField Label="Förnamn" 
                          Name="FirstName"
                          @bind-Value="FirstName"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          Class="mb-4"
                          autocomplete="given-name"
                          Required="true" />
            
            <MudTextField Label="Efternamn" 
                          Name="LastName"
                          @bind-Value="LastName"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          Class="mb-4"
                          autocomplete="family-name"
                          Required="true" />
            
            <MudTextField Label="E-post" 
                          Name="Email"
                          @bind-Value="Email"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          Class="mb-4"
                          autocomplete="username"
                          Required="true" />
            
            <MudTextField Label="Lösenord" 
                          Name="Password"
                          @bind-Value="Password"
                          InputType="InputType.Password"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          Class="mb-4"
                          autocomplete="new-password"
                          Required="true" />
            
            <MudTextField Label="Bekräfta lösenord" 
                          Name="ConfirmPassword"
                          @bind-Value="ConfirmPassword"
                          InputType="InputType.Password"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          Class="mb-4"
                          autocomplete="new-password"
                          Required="true" />
            
            <MudButton ButtonType="ButtonType.Submit" 
                       Variant="Variant.Filled" 
                       Color="Color.Primary" 
                       FullWidth="true"
                       Class="mb-4">
                Registrera
            </MudButton>
        </form>
        
        <MudText Align="Align.Center">
            Har du redan ett konto? <MudLink Href="/Account/Login">Logga in</MudLink>
        </MudText>
    </MudPaper>
</MudContainer>

@code {
    [SupplyParameterFromQuery(Name = "error")]
    private string? Error { get; set; }

    [SupplyParameterFromQuery(Name = "details")]
    private string? Details { get; set; }

    private string FirstName { get; set; } = "";
    private string LastName { get; set; } = "";
    private string Email { get; set; } = "";
    private string Password { get; set; } = "";
    private string ConfirmPassword { get; set; } = "";

    private string? ErrorMessage => Error switch
    {
        "empty" => "E-post och lösenord krävs.",
        "passwordmismatch" => "Lösenorden matchar inte.",
        "passwordtooshort" => "Lösenordet måste vara minst 6 tecken.",
        "create" => $"Kunde inte skapa konto: {Details ?? "Okänt fel"}",
        _ => null
    };
}
