@page "/Account/Login"
@attribute [AllowAnonymous]
@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Authorization

<PageTitle>Logga in</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small" Class="mt-8">
    <MudPaper Elevation="3" Class="pa-6">
        <MudText Typo="Typo.h4" Align="Align.Center" GutterBottom="true">
            Logga in
        </MudText>
        
        @if (!string.IsNullOrEmpty(ErrorMessage))
        {
            <MudAlert Severity="Severity.Error" Class="mb-4">@ErrorMessage</MudAlert>
        }
        
        <form method="post" action="/Account/PerformLogin">
            <input type="hidden" name="ReturnUrl" value="@ReturnUrl" />
            
            <MudTextField Label="E-post" 
                          Name="Email"
                          @bind-Value="Email"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          Class="mb-4"
                          autocomplete="username"
                          Required="true" />
            
            <MudTextField Label="Lösenord" 
                          Name="Password"
                          @bind-Value="Password"
                          InputType="InputType.Password"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          Class="mb-4"
                          autocomplete="current-password"
                          Required="true" />
            
            <div class="mb-4">
                <input type="hidden" name="RememberMe" value="@(RememberMe ? "true" : "false")" />
                <MudCheckBox @bind-Value="RememberMe" Label="Kom ihåg mig" />
            </div>
            
            <MudButton ButtonType="ButtonType.Submit" 
                       Variant="Variant.Filled" 
                       Color="Color.Primary" 
                       FullWidth="true"
                       Class="mb-4">
                Logga in
            </MudButton>
        </form>
        
        <MudText Align="Align.Center">
            Har du inget konto? <MudLink Href="/Account/Register">Registrera dig</MudLink>
        </MudText>
    </MudPaper>
</MudContainer>

@code {
    [SupplyParameterFromQuery]
    private string? ReturnUrl { get; set; }

    [SupplyParameterFromQuery(Name = "error")]
    private string? Error { get; set; }

    private string Email { get; set; } = "";
    private string Password { get; set; } = "";
    private bool RememberMe { get; set; }

    private string? ErrorMessage => Error switch
    {
        "invalid" => "Felaktigt användarnamn eller lösenord.",
        "lockedout" => "Kontot är låst. Vänta och försök igen senare.",
        "empty" => "E-post och lösenord krävs.",
        _ => null
    };
}
